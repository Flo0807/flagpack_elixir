defmodule FlagpackTest do
  use ExUnit.Case, async: true

  import Phoenix.LiveViewTest

  setup do
    Mix.Task.run("build")
    {:ok, assigns: %{__changed__: nil}}
  end

  test "flag" do
    assert render_component(&Flagpack.usa/1, %{id: "usa-flag"}) ==
             ~s|<div id="usa-flag" class=\"\">\n  <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 32 24\">\n    <mask id=\"USA_svg__a_usa-flag\" width=\"32\" height=\"24\" x=\"0\" y=\"0\" maskUnits=\"userSpaceOnUse\">\n      <path fill=\"#fff\" d=\"M0 0h32v24H0z\"></path>\n    </mask>\n    <g mask=\"url(#USA_svg__a_usa-flag)\">\n      <path fill=\"#F7FCFF\" fill-rule=\"evenodd\" d=\"M0 0h32v24H0V0z\" clip-rule=\"evenodd\"></path><path fill=\"#E31D1C\" fill-rule=\"evenodd\" d=\"M0 14.667v2h32v-2H0zm0 3.666v2h32v-2H0zm0-11v2h32v-2H0zM0 22v2h32v-2H0zm0-11v2h32v-2H0zM0 0v2h32V0H0zm0 3.667v2h32v-2H0z\" clip-rule=\"evenodd\"></path><path fill=\"#2E42A5\" d=\"M0 0h20v13H0z\"></path><path fill=\"#F7FCFF\" fill-rule=\"evenodd\" d=\"M1.722 2.939l-.726.509.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm4 0l-.726.509.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.509l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zM.996 7.449l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74H.596l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zM.996 11.449l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74H.596l.645.574-.245.905zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.905-.702-.508zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.905zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.905-.702-.508zm3.274-7.49l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm.726 3.49l-.726.51.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.905zM3.722 4.938l-.726.51.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-8.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-4.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906z\" clip-rule=\"evenodd\"></path>\n    </g>\n  </svg>\n</div>|

    assert render_component(&Flagpack.usa/1, %{id: "usa-flag", class: "w-5 h-5"}) ==
             ~s|<div id="usa-flag" class=\"w-5 h-5\">\n  <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 32 24\">\n    <mask id=\"USA_svg__a_usa-flag\" width=\"32\" height=\"24\" x=\"0\" y=\"0\" maskUnits=\"userSpaceOnUse\">\n      <path fill=\"#fff\" d=\"M0 0h32v24H0z\"></path>\n    </mask>\n    <g mask=\"url(#USA_svg__a_usa-flag)\">\n      <path fill=\"#F7FCFF\" fill-rule=\"evenodd\" d=\"M0 0h32v24H0V0z\" clip-rule=\"evenodd\"></path><path fill=\"#E31D1C\" fill-rule=\"evenodd\" d=\"M0 14.667v2h32v-2H0zm0 3.666v2h32v-2H0zm0-11v2h32v-2H0zM0 22v2h32v-2H0zm0-11v2h32v-2H0zM0 0v2h32V0H0zm0 3.667v2h32v-2H0z\" clip-rule=\"evenodd\"></path><path fill=\"#2E42A5\" d=\"M0 0h20v13H0z\"></path><path fill=\"#F7FCFF\" fill-rule=\"evenodd\" d=\"M1.722 2.939l-.726.509.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm4 0l-.726.509.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.509l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zM.996 7.449l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74H.596l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zM.996 11.449l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74H.596l.645.574-.245.905zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.905-.702-.508zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.905zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.905-.702-.508zm3.274-7.49l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm.726 3.49l-.726.51.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.905zM3.722 4.938l-.726.51.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-8.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-4.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906z\" clip-rule=\"evenodd\"></path>\n    </g>\n  </svg>\n</div>|
  end

  test "dynamic flag" do
    assert render_component(&Flagpack.flag/1, %{id: "usa-flag", name: :usa}) ==
             ~s|<div id="usa-flag" class=\"\">\n  <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 32 24\">\n    <mask id=\"USA_svg__a_usa-flag\" width=\"32\" height=\"24\" x=\"0\" y=\"0\" maskUnits=\"userSpaceOnUse\">\n      <path fill=\"#fff\" d=\"M0 0h32v24H0z\"></path>\n    </mask>\n    <g mask=\"url(#USA_svg__a_usa-flag)\">\n      <path fill=\"#F7FCFF\" fill-rule=\"evenodd\" d=\"M0 0h32v24H0V0z\" clip-rule=\"evenodd\"></path><path fill=\"#E31D1C\" fill-rule=\"evenodd\" d=\"M0 14.667v2h32v-2H0zm0 3.666v2h32v-2H0zm0-11v2h32v-2H0zM0 22v2h32v-2H0zm0-11v2h32v-2H0zM0 0v2h32V0H0zm0 3.667v2h32v-2H0z\" clip-rule=\"evenodd\"></path><path fill=\"#2E42A5\" d=\"M0 0h20v13H0z\"></path><path fill=\"#F7FCFF\" fill-rule=\"evenodd\" d=\"M1.722 2.939l-.726.509.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm4 0l-.726.509.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.509l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zM.996 7.449l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74H.596l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zM.996 11.449l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74H.596l.645.574-.245.905zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.905-.702-.508zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.905zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.905-.702-.508zm3.274-7.49l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm.726 3.49l-.726.51.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.905zM3.722 4.938l-.726.51.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-8.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-4.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906z\" clip-rule=\"evenodd\"></path>\n    </g>\n  </svg>\n</div>|

    assert render_component(&Flagpack.flag/1, %{id: "usa-flag", name: :usa, class: "w-5 h-5"}) ==
             ~s|<div id="usa-flag" class=\"w-5 h-5\">\n  <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 32 24\">\n    <mask id=\"USA_svg__a_usa-flag\" width=\"32\" height=\"24\" x=\"0\" y=\"0\" maskUnits=\"userSpaceOnUse\">\n      <path fill=\"#fff\" d=\"M0 0h32v24H0z\"></path>\n    </mask>\n    <g mask=\"url(#USA_svg__a_usa-flag)\">\n      <path fill=\"#F7FCFF\" fill-rule=\"evenodd\" d=\"M0 0h32v24H0V0z\" clip-rule=\"evenodd\"></path><path fill=\"#E31D1C\" fill-rule=\"evenodd\" d=\"M0 14.667v2h32v-2H0zm0 3.666v2h32v-2H0zm0-11v2h32v-2H0zM0 22v2h32v-2H0zm0-11v2h32v-2H0zM0 0v2h32V0H0zm0 3.667v2h32v-2H0z\" clip-rule=\"evenodd\"></path><path fill=\"#2E42A5\" d=\"M0 0h20v13H0z\"></path><path fill=\"#F7FCFF\" fill-rule=\"evenodd\" d=\"M1.722 2.939l-.726.509.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm4 0l-.726.509.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.509l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zM.996 7.449l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74H.596l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zM.996 11.449l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74H.596l.645.574-.245.905zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.905-.702-.508zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.905zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.905-.702-.508zm3.274-7.49l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm.726 3.49l-.726.51.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.905zM3.722 4.938l-.726.51.245-.906-.645-.574h.843l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-8.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.843l.645.574-.245.906zm4.726-.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm3.274.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906zm4.726-4.51l-.726.51.245-.906-.644-.574h.842l.282-.74.331.74h.718l-.564.574.218.906-.702-.51zm-.726 4.51l.726-.51.702.51-.218-.906.564-.574h-.718l-.331-.74-.282.74h-.842l.644.574-.245.906z\" clip-rule=\"evenodd\"></path>\n    </g>\n  </svg>\n</div>|
  end

  test "generated docs" do
    {:docs_v1, _annotation, _beam_language, _format, _module_doc, _metadata, docs} = Code.fetch_docs(Flagpack)

    doc =
      Enum.find_value(docs, fn
        {{:function, :usa, 1}, _annotation, _signature, doc, _metadata} -> doc
        _ -> nil
      end)

    assert doc["en"] ==
             """
             Renders the United States of America flag.

             ## Examples

                 <Flagpack.usa />
                 <Flagpack.usa id="my-flag" />
                 <Flagpack.usa class="size-5" />

             ## Attributes

             * `id` (`:string`) - The ID for the outer div element and suffix for internal SVG IDs. When not provided, a unique ID will be generated. Defaults to `nil`.
             * `class` (`:string`) - Additional CSS classes to apply to the outer div element. Defaults to `nil`.
             """
  end
end
